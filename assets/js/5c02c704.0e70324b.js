"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[6443],{8003:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"module-01-ros2/week-03/ch02-services-actions","title":"ROS 2 Services and Actions","description":"Learning Objectives","source":"@site/docs/module-01-ros2/week-03/ch02-services-actions.md","sourceDirName":"module-01-ros2/week-03","slug":"/module-01-ros2/week-03/ch02-services-actions","permalink":"/AI_COURSE_book/docs/module-01-ros2/week-03/ch02-services-actions","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module-01-ros2/week-03/ch02-services-actions.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"ch02-services-actions","title":"ROS 2 Services and Actions","sidebar_label":"Services & Actions","sidebar_position":2},"sidebar":"textbookSidebar","previous":{"title":"Nodes and Topics","permalink":"/AI_COURSE_book/docs/module-01-ros2/week-03/ch01-nodes-topics"},"next":{"title":"Python with rclpy","permalink":"/AI_COURSE_book/docs/module-01-ros2/week-04/ch03-python-rclpy"}}');var r=s(4848),l=s(8453);const c={id:"ch02-services-actions",title:"ROS 2 Services and Actions",sidebar_label:"Services & Actions",sidebar_position:2},t="ROS 2 Services and Actions",o={},a=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Introduction",id:"introduction",level:2},{value:"1. ROS 2 Services",id:"1-ros-2-services",level:2},{value:"What Are Services?",id:"what-are-services",level:3},{value:"When to Use Services",id:"when-to-use-services",level:3},{value:"Service Definition",id:"service-definition",level:3},{value:"Implementing a Service Server",id:"implementing-a-service-server",level:3},{value:"Implementing a Service Client",id:"implementing-a-service-client",level:3},{value:"2. ROS 2 Actions",id:"2-ros-2-actions",level:2},{value:"What Are Actions?",id:"what-are-actions",level:3},{value:"When to Use Actions",id:"when-to-use-actions",level:3},{value:"Action Definition",id:"action-definition",level:3},{value:"Implementing an Action Server",id:"implementing-an-action-server",level:3},{value:"Implementing an Action Client",id:"implementing-an-action-client",level:3},{value:"3. Choosing the Right Pattern",id:"3-choosing-the-right-pattern",level:2},{value:"Decision Tree",id:"decision-tree",level:3},{value:"Example Scenarios",id:"example-scenarios",level:3},{value:"4. Best Practices",id:"4-best-practices",level:2},{value:"Service Best Practices",id:"service-best-practices",level:3},{value:"Action Best Practices",id:"action-best-practices",level:3},{value:"Common Pitfalls",id:"common-pitfalls",level:3},{value:"Practical Example: Robot Task Coordinator",id:"practical-example-robot-task-coordinator",level:2},{value:"Summary",id:"summary",level:2},{value:"Review Questions",id:"review-questions",level:2},{value:"Hands-on Exercises",id:"hands-on-exercises",level:2},{value:"Exercise 1: Temperature Converter Service",id:"exercise-1-temperature-converter-service",level:3},{value:"Exercise 2: Countdown Action",id:"exercise-2-countdown-action",level:3},{value:"Exercise 3: Robot State Manager",id:"exercise-3-robot-state-manager",level:3},{value:"Further Reading",id:"further-reading",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"ros-2-services-and-actions",children:"ROS 2 Services and Actions"})}),"\n",(0,r.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,r.jsx)(n.p,{children:"By the end of this chapter, you will be able to:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Understand the request-response pattern of ROS 2 services"}),"\n",(0,r.jsx)(n.li,{children:"Implement service servers and clients in Python"}),"\n",(0,r.jsx)(n.li,{children:"Understand the goal-feedback-result pattern of ROS 2 actions"}),"\n",(0,r.jsx)(n.li,{children:"Implement action servers and clients with cancellation support"}),"\n",(0,r.jsx)(n.li,{children:"Choose the appropriate communication pattern (topic, service, or action) for different scenarios"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsx)(n.p,{children:"In the previous chapter, we learned about ROS 2 nodes and topics, which provide asynchronous, many-to-many communication through the publish-subscribe pattern. However, not all robotics problems fit this pattern. Sometimes we need:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Synchronous request-response"}),': "What is the current battery level?" requires an immediate answer']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Long-running tasks with feedback"}),': "Navigate to the kitchen" takes time and we want progress updates']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cancellable operations"}),': "Stop navigating, emergency detected!"']}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"ROS 2 provides two additional communication patterns to address these needs:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Services"}),": Synchronous request-response for short operations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Actions"}),": Asynchronous goal-feedback-result for long-running tasks"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Understanding when to use each pattern is crucial for building robust robotic systems."}),"\n",(0,r.jsx)(n.h2,{id:"1-ros-2-services",children:"1. ROS 2 Services"}),"\n",(0,r.jsx)(n.h3,{id:"what-are-services",children:"What Are Services?"}),"\n",(0,r.jsxs)(n.p,{children:["Services implement a ",(0,r.jsx)(n.strong,{children:"client-server"})," model where:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.strong,{children:"service server"})," provides functionality and waits for requests"]}),"\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.strong,{children:"service client"})," sends a request and blocks until receiving a response"]}),"\n",(0,r.jsxs)(n.li,{children:["Communication is ",(0,r.jsx)(n.strong,{children:"one-to-one"})," and ",(0,r.jsx)(n.strong,{children:"synchronous"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key characteristics:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Blocking"}),": Client waits for the response before continuing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Short-lived"}),": Designed for quick operations (typically <1 second)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Request-response"}),": One request produces exactly one response"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"No feedback"}),": No progress updates during execution"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"when-to-use-services",children:"When to Use Services"}),"\n",(0,r.jsx)(n.p,{children:"Services are ideal for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Querying robot state (battery level, sensor readings)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Triggering actions (reset odometry, start/stop recording)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Configuration changes (set parameters, update gains)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Short computations (coordinate transformations, simple calculations)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Avoid services for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u274c Long-running tasks (navigation, manipulation)"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Streaming data (use topics instead)"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Operations that need progress updates"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Tasks that might need cancellation"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"service-definition",children:"Service Definition"}),"\n",(0,r.jsxs)(n.p,{children:["Services are defined using ",(0,r.jsx)(n.code,{children:".srv"})," files with two parts separated by ",(0,r.jsx)(n.code,{children:"---"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# example_interfaces/srv/AddTwoInts.srv\nint64 a\nint64 b\n---\nint64 sum\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The upper section defines the ",(0,r.jsx)(n.strong,{children:"request"}),", and the lower section defines the ",(0,r.jsx)(n.strong,{children:"response"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"implementing-a-service-server",children:"Implementing a Service Server"}),"\n",(0,r.jsx)(n.p,{children:"Here's a complete service server that adds two integers:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass AddTwoIntsServer(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_server')\n\n        # Create service\n        self.srv = self.create_service(\n            AddTwoInts,           # Service type\n            'add_two_ints',       # Service name\n            self.add_callback     # Callback function\n        )\n\n        self.get_logger().info('Service server ready')\n\n    def add_callback(self, request, response):\n        \"\"\"Handle incoming service requests\"\"\"\n        response.sum = request.a + request.b\n        self.get_logger().info(\n            f'Request: {request.a} + {request.b} = {response.sum}'\n        )\n        return response\n\ndef main(args=None):\n    rclpy.init(args=args)\n    server = AddTwoIntsServer()\n    rclpy.spin(server)\n    server.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key points:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"create_service()"})," registers the service with the ROS 2 system"]}),"\n",(0,r.jsxs)(n.li,{children:["The callback receives ",(0,r.jsx)(n.code,{children:"request"})," and ",(0,r.jsx)(n.code,{children:"response"})," objects"]}),"\n",(0,r.jsxs)(n.li,{children:["The callback must return the filled ",(0,r.jsx)(n.code,{children:"response"})," object"]}),"\n",(0,r.jsx)(n.li,{children:"Service callbacks should be fast (avoid blocking operations)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"implementing-a-service-client",children:"Implementing a Service Client"}),"\n",(0,r.jsx)(n.p,{children:"Here's the corresponding client:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass AddTwoIntsClient(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_client')\n\n        # Create client\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n\n        # Wait for service to be available\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Waiting for service...')\n\n    def send_request(self, a, b):\n        \"\"\"Send request and wait for response\"\"\"\n        request = AddTwoInts.Request()\n        request.a = a\n        request.b = b\n\n        # Call service asynchronously\n        future = self.cli.call_async(request)\n\n        # Wait for result\n        rclpy.spin_until_future_complete(self, future)\n\n        return future.result()\n\ndef main(args=None):\n    rclpy.init(args=args)\n    client = AddTwoIntsClient()\n\n    result = client.send_request(5, 7)\n    client.get_logger().info(f'Result: {result.sum}')\n\n    client.destroy_node()\n    rclpy.shutdown()\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key points:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"wait_for_service()"})," ensures the server is available before calling"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"call_async()"})," sends the request and returns a future"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"spin_until_future_complete()"})," blocks until the response arrives"]}),"\n",(0,r.jsx)(n.li,{children:"Always check if the service call succeeded before using the result"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"2-ros-2-actions",children:"2. ROS 2 Actions"}),"\n",(0,r.jsx)(n.h3,{id:"what-are-actions",children:"What Are Actions?"}),"\n",(0,r.jsxs)(n.p,{children:["Actions provide a ",(0,r.jsx)(n.strong,{children:"goal-feedback-result"})," pattern for long-running tasks:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.strong,{children:"goal"})," defines what to achieve"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Feedback"})," provides progress updates during execution"]}),"\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.strong,{children:"result"})," is returned when the task completes"]}),"\n",(0,r.jsxs)(n.li,{children:["Goals can be ",(0,r.jsx)(n.strong,{children:"cancelled"})," mid-execution"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key characteristics:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Asynchronous"}),": Client doesn't block while waiting"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Long-running"}),": Designed for tasks taking seconds to minutes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Feedback"}),": Regular progress updates"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cancellable"}),": Can be stopped before completion"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Stateful"}),": Tracks goal state (pending, active, succeeded, cancelled, aborted)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"when-to-use-actions",children:"When to Use Actions"}),"\n",(0,r.jsx)(n.p,{children:"Actions are ideal for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Navigation to a goal position"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Manipulation tasks (pick and place)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Trajectory execution"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Long computations with progress tracking"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Any task that might need cancellation"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Avoid actions for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u274c Quick operations (use services)"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Continuous data streams (use topics)"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Simple queries"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"action-definition",children:"Action Definition"}),"\n",(0,r.jsxs)(n.p,{children:["Actions are defined using ",(0,r.jsx)(n.code,{children:".action"})," files with three parts:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# example_interfaces/action/Fibonacci.action\n\n# Goal\nint32 order\n---\n# Result\nint32[] sequence\n---\n# Feedback\nint32[] sequence\n"})}),"\n",(0,r.jsx)(n.p,{children:"The three sections define:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Goal"}),": What the client wants to achieve"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Result"}),": What the server returns upon completion"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Feedback"}),": Progress updates sent during execution"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"implementing-an-action-server",children:"Implementing an Action Server"}),"\n",(0,r.jsx)(n.p,{children:"Here's an action server that computes Fibonacci sequences:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import time\nimport rclpy\nfrom rclpy.node import Node\nfrom rclpy.action import ActionServer, CancelResponse, GoalResponse\nfrom example_interfaces.action import Fibonacci\n\nclass FibonacciActionServer(Node):\n    def __init__(self):\n        super().__init__(\'fibonacci_action_server\')\n\n        self._action_server = ActionServer(\n            self,\n            Fibonacci,\n            \'fibonacci\',\n            execute_callback=self.execute_callback,\n            goal_callback=self.goal_callback,\n            cancel_callback=self.cancel_callback\n        )\n\n        self.get_logger().info(\'Action server ready\')\n\n    def goal_callback(self, goal_request):\n        """Accept or reject goals"""\n        if goal_request.order < 0 or goal_request.order > 50:\n            self.get_logger().warn(\'Rejecting invalid goal\')\n            return GoalResponse.REJECT\n\n        self.get_logger().info(f\'Accepting goal: order={goal_request.order}\')\n        return GoalResponse.ACCEPT\n\n    def cancel_callback(self, goal_handle):\n        """Handle cancellation requests"""\n        self.get_logger().info(\'Cancellation requested\')\n        return CancelResponse.ACCEPT\n\n    async def execute_callback(self, goal_handle):\n        """Execute the goal with feedback"""\n        self.get_logger().info(\'Executing goal...\')\n\n        # Initialize sequence\n        sequence = [0, 1]\n        order = goal_handle.request.order\n\n        # Compute Fibonacci sequence\n        for i in range(1, order):\n            # Check for cancellation\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                result = Fibonacci.Result()\n                result.sequence = sequence\n                return result\n\n            # Compute next number\n            sequence.append(sequence[i] + sequence[i-1])\n\n            # Send feedback\n            feedback = Fibonacci.Feedback()\n            feedback.sequence = sequence\n            goal_handle.publish_feedback(feedback)\n\n            self.get_logger().info(f\'Feedback: {sequence}\')\n\n            # Simulate computation time\n            time.sleep(0.5)\n\n        # Mark goal as succeeded\n        goal_handle.succeed()\n\n        # Return result\n        result = Fibonacci.Result()\n        result.sequence = sequence\n        return result\n\ndef main(args=None):\n    rclpy.init(args=args)\n    server = FibonacciActionServer()\n    rclpy.spin(server)\n    server.destroy_node()\n    rclpy.shutdown()\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key points:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"goal_callback"})," validates and accepts/rejects goals"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cancel_callback"})," handles cancellation requests"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"execute_callback"})," performs the work and sends feedback"]}),"\n",(0,r.jsxs)(n.li,{children:["Check ",(0,r.jsx)(n.code,{children:"is_cancel_requested"})," regularly to support cancellation"]}),"\n",(0,r.jsxs)(n.li,{children:["Call ",(0,r.jsx)(n.code,{children:"goal_handle.succeed()"})," or ",(0,r.jsx)(n.code,{children:"goal_handle.canceled()"})," to set final state"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"implementing-an-action-client",children:"Implementing an Action Client"}),"\n",(0,r.jsx)(n.p,{children:"Here's the corresponding client:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import rclpy\nfrom rclpy.node import Node\nfrom rclpy.action import ActionClient\nfrom example_interfaces.action import Fibonacci\n\nclass FibonacciActionClient(Node):\n    def __init__(self):\n        super().__init__(\'fibonacci_action_client\')\n        self._action_client = ActionClient(self, Fibonacci, \'fibonacci\')\n\n    def send_goal(self, order):\n        """Send goal to action server"""\n        goal_msg = Fibonacci.Goal()\n        goal_msg.order = order\n\n        self._action_client.wait_for_server()\n\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback\n        )\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def feedback_callback(self, feedback_msg):\n        """Receive feedback during execution"""\n        feedback = feedback_msg.feedback\n        self.get_logger().info(f\'Feedback: {feedback.sequence}\')\n\n    def goal_response_callback(self, future):\n        """Handle goal acceptance/rejection"""\n        goal_handle = future.result()\n\n        if not goal_handle.accepted:\n            self.get_logger().error(\'Goal rejected\')\n            return\n\n        self.get_logger().info(\'Goal accepted\')\n\n        self._get_result_future = goal_handle.get_result_async()\n        self._get_result_future.add_done_callback(self.get_result_callback)\n\n    def get_result_callback(self, future):\n        """Handle final result"""\n        result = future.result().result\n        status = future.result().status\n\n        if status == 4:  # SUCCEEDED\n            self.get_logger().info(f\'Success! Result: {result.sequence}\')\n        elif status == 5:  # CANCELED\n            self.get_logger().warn(f\'Canceled. Partial: {result.sequence}\')\n\n        rclpy.shutdown()\n'})}),"\n",(0,r.jsx)(n.h2,{id:"3-choosing-the-right-pattern",children:"3. Choosing the Right Pattern"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Pattern"}),(0,r.jsx)(n.th,{children:"Use Case"}),(0,r.jsx)(n.th,{children:"Duration"}),(0,r.jsx)(n.th,{children:"Feedback"}),(0,r.jsx)(n.th,{children:"Cancellable"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Topic"})}),(0,r.jsx)(n.td,{children:"Streaming data"}),(0,r.jsx)(n.td,{children:"Continuous"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"N/A"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Service"})}),(0,r.jsx)(n.td,{children:"Quick queries"}),(0,r.jsx)(n.td,{children:"<1 second"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"No"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Action"})}),(0,r.jsx)(n.td,{children:"Long tasks"}),(0,r.jsx)(n.td,{children:"Seconds-minutes"}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"Yes"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"decision-tree",children:"Decision Tree"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Do you need bidirectional communication?\n\u251c\u2500 No \u2192 Use Topic\n\u2514\u2500 Yes\n   \u251c\u2500 Is it quick (&lt;1 sec)?\n   \u2502  \u2514\u2500 Yes \u2192 Use Service\n   \u2514\u2500 No (long-running)\n      \u2514\u2500 Use Action\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-scenarios",children:"Example Scenarios"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Scenario 1: Robot Battery Monitor"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Pattern: ",(0,r.jsx)(n.strong,{children:"Topic"})]}),"\n",(0,r.jsx)(n.li,{children:"Why: Continuous stream of battery readings"}),"\n",(0,r.jsx)(n.li,{children:"Publisher: Battery driver node"}),"\n",(0,r.jsx)(n.li,{children:"Subscribers: Display node, power management node"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Scenario 2: Get Current Joint Positions"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Pattern: ",(0,r.jsx)(n.strong,{children:"Service"})]}),"\n",(0,r.jsx)(n.li,{children:"Why: Quick query, immediate response needed"}),"\n",(0,r.jsx)(n.li,{children:"Server: Joint state controller"}),"\n",(0,r.jsx)(n.li,{children:"Client: Motion planning node"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Scenario 3: Navigate to Kitchen"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Pattern: ",(0,r.jsx)(n.strong,{children:"Action"})]}),"\n",(0,r.jsx)(n.li,{children:"Why: Long-running, needs feedback, might need cancellation"}),"\n",(0,r.jsx)(n.li,{children:"Server: Navigation stack"}),"\n",(0,r.jsx)(n.li,{children:"Client: Task planning node"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Scenario 4: Pick and Place Object"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Pattern: ",(0,r.jsx)(n.strong,{children:"Action"})]}),"\n",(0,r.jsx)(n.li,{children:"Why: Multi-step task, feedback on progress, cancellable"}),"\n",(0,r.jsx)(n.li,{children:"Server: Manipulation controller"}),"\n",(0,r.jsx)(n.li,{children:"Client: High-level task planner"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"4-best-practices",children:"4. Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"service-best-practices",children:"Service Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Keep callbacks fast"}),": Service callbacks should complete in <100ms"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validate inputs"}),": Check request parameters before processing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Handle errors gracefully"}),": Return error codes or status in response"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use meaningful names"}),": ",(0,r.jsx)(n.code,{children:"get_battery_level"})," not ",(0,r.jsx)(n.code,{children:"service1"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Document behavior"}),": Specify expected inputs, outputs, and edge cases"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"action-best-practices",children:"Action Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Send regular feedback"}),": Update clients every 0.1-1 seconds"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Check cancellation"}),": Call ",(0,r.jsx)(n.code,{children:"is_cancel_requested"})," in loops"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validate goals"}),": Reject invalid goals early in ",(0,r.jsx)(n.code,{children:"goal_callback"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Set final state"}),": Always call ",(0,r.jsx)(n.code,{children:"succeed()"}),", ",(0,r.jsx)(n.code,{children:"canceled()"}),", or ",(0,r.jsx)(n.code,{children:"abort()"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Provide meaningful results"}),": Include summary statistics or final state"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"common-pitfalls",children:"Common Pitfalls"}),"\n",(0,r.jsxs)(n.p,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Using services for long operations"}),": Blocks the client"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Solution: Use actions instead"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Not checking if service exists"}),": Client crashes if server unavailable"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 Solution: Use ",(0,r.jsx)(n.code,{children:"wait_for_service()"})," with timeout"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Forgetting to check cancellation"}),": Action can't be stopped"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 Solution: Check ",(0,r.jsx)(n.code,{children:"is_cancel_requested"})," regularly"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Blocking in service callbacks"}),": Degrades system performance"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Solution: Keep callbacks fast or use actions"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"practical-example-robot-task-coordinator",children:"Practical Example: Robot Task Coordinator"}),"\n",(0,r.jsx)(n.p,{children:"Let's combine services and actions in a realistic scenario:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"class RobotTaskCoordinator(Node):\n    def __init__(self):\n        super().__init__('task_coordinator')\n\n        # Service client to check if robot is ready\n        self.ready_client = self.create_client(\n            Trigger, 'check_robot_ready'\n        )\n\n        # Action client for navigation\n        self.nav_client = ActionClient(\n            self, NavigateToPose, 'navigate_to_pose'\n        )\n\n    async def execute_mission(self):\n        # 1. Check if robot is ready (service)\n        if not await self.is_robot_ready():\n            self.get_logger().error('Robot not ready')\n            return\n\n        # 2. Navigate to target (action)\n        success = await self.navigate_to_goal(target_pose)\n\n        if success:\n            self.get_logger().info('Mission complete!')\n        else:\n            self.get_logger().error('Navigation failed')\n\n    async def is_robot_ready(self):\n        \"\"\"Quick check using service\"\"\"\n        request = Trigger.Request()\n        future = self.ready_client.call_async(request)\n        response = await future\n        return response.success\n\n    async def navigate_to_goal(self, pose):\n        \"\"\"Long-running navigation using action\"\"\"\n        goal = NavigateToPose.Goal()\n        goal.pose = pose\n\n        goal_handle = await self.nav_client.send_goal_async(goal)\n        result = await goal_handle.get_result_async()\n\n        return result.status == 4  # SUCCEEDED\n"})}),"\n",(0,r.jsx)(n.p,{children:"This example demonstrates:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Using services for quick checks"}),"\n",(0,r.jsx)(n.li,{children:"Using actions for long-running tasks"}),"\n",(0,r.jsx)(n.li,{children:"Combining both patterns in a single node"}),"\n",(0,r.jsx)(n.li,{children:"Async/await for cleaner code structure"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.p,{children:"In this chapter, we learned:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Services"})," provide synchronous request-response for quick operations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Actions"})," provide asynchronous goal-feedback-result for long-running tasks"]}),"\n",(0,r.jsx)(n.li,{children:"Services are blocking and cannot be cancelled"}),"\n",(0,r.jsx)(n.li,{children:"Actions support feedback and cancellation"}),"\n",(0,r.jsx)(n.li,{children:"Choosing the right pattern depends on task duration and requirements"}),"\n",(0,r.jsx)(n.li,{children:"Services and actions complement topics to provide a complete communication toolkit"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use topics for streaming data"}),"\n",(0,r.jsx)(n.li,{children:"Use services for quick queries (<1 second)"}),"\n",(0,r.jsx)(n.li,{children:"Use actions for long tasks with feedback"}),"\n",(0,r.jsx)(n.li,{children:"Always validate inputs and handle errors"}),"\n",(0,r.jsx)(n.li,{children:"Check for cancellation in action servers"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"review-questions",children:"Review Questions"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"What is the main difference between a service and an action?"}),"\n",(0,r.jsx)(n.li,{children:"When would you use a service instead of an action?"}),"\n",(0,r.jsxs)(n.li,{children:["Why is it important to check ",(0,r.jsx)(n.code,{children:"is_cancel_requested"})," in action servers?"]}),"\n",(0,r.jsx)(n.li,{children:"What happens if a service client calls a non-existent service?"}),"\n",(0,r.jsx)(n.li,{children:"Can a single action server handle multiple goals simultaneously?"}),"\n",(0,r.jsx)(n.li,{children:"What are the three parts of an action definition file?"}),"\n",(0,r.jsx)(n.li,{children:"Why should service callbacks be fast?"}),"\n",(0,r.jsx)(n.li,{children:"How do you reject a goal in an action server?"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"hands-on-exercises",children:"Hands-on Exercises"}),"\n",(0,r.jsx)(n.h3,{id:"exercise-1-temperature-converter-service",children:"Exercise 1: Temperature Converter Service"}),"\n",(0,r.jsx)(n.p,{children:"Create a service that converts between Celsius and Fahrenheit:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Service definition: takes temperature and unit (C/F)"}),"\n",(0,r.jsx)(n.li,{children:"Returns converted temperature"}),"\n",(0,r.jsx)(n.li,{children:"Test with various inputs"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"exercise-2-countdown-action",children:"Exercise 2: Countdown Action"}),"\n",(0,r.jsx)(n.p,{children:"Create an action that counts down from N to 0:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Goal: Starting number"}),"\n",(0,r.jsx)(n.li,{children:"Feedback: Current count"}),"\n",(0,r.jsx)(n.li,{children:"Result: Final message"}),"\n",(0,r.jsx)(n.li,{children:"Support cancellation mid-countdown"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"exercise-3-robot-state-manager",children:"Exercise 3: Robot State Manager"}),"\n",(0,r.jsx)(n.p,{children:"Build a node that:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Provides a service to query robot state (idle, moving, charging)"}),"\n",(0,r.jsx)(n.li,{children:"Provides an action to change state with validation"}),"\n",(0,r.jsx)(n.li,{children:"Sends feedback during state transitions"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Service-And-Client.html",children:"ROS 2 Services Documentation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Intermediate/Writing-an-Action-Server-Client/Py.html",children:"ROS 2 Actions Documentation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts/About-Quality-of-Service-Settings.html",children:"Understanding Quality of Service"})}),"\n",(0,r.jsxs)(n.li,{children:["Code examples: ",(0,r.jsx)(n.code,{children:"/static/code/ros2/chapter02/"})]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Next Chapter"}),": ",(0,r.jsx)(n.a,{href:"/AI_COURSE_book/docs/module-01-ros2/week-04/ch03-python-rclpy",children:"Python Programming with rclpy \u2192"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Previous Chapter"}),": ",(0,r.jsx)(n.a,{href:"/AI_COURSE_book/docs/module-01-ros2/week-03/ch01-nodes-topics",children:"\u2190 ROS 2 Nodes and Topics"})]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>t});var i=s(6540);const r={},l=i.createContext(r);function c(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);