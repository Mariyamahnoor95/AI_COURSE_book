"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[2912],{2451:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"module-01-ros2/week-04/ch03-python-rclpy","title":"Python Programming with rclpy","description":"Learning Objectives","source":"@site/docs/module-01-ros2/week-04/ch03-python-rclpy.md","sourceDirName":"module-01-ros2/week-04","slug":"/module-01-ros2/week-04/ch03-python-rclpy","permalink":"/AI_COURSE_book/docs/module-01-ros2/week-04/ch03-python-rclpy","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module-01-ros2/week-04/ch03-python-rclpy.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"id":"ch03-python-rclpy","title":"Python Programming with rclpy","sidebar_label":"Python with rclpy","sidebar_position":1},"sidebar":"textbookSidebar","previous":{"title":"Services & Actions","permalink":"/AI_COURSE_book/docs/module-01-ros2/week-03/ch02-services-actions"},"next":{"title":"Coordinate Transforms","permalink":"/AI_COURSE_book/docs/module-01-ros2/week-04/ch04-tf2-transforms"}}');var l=s(4848),i=s(8453);const a={id:"ch03-python-rclpy",title:"Python Programming with rclpy",sidebar_label:"Python with rclpy",sidebar_position:1},t="Python Programming with rclpy",o={},c=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Introduction",id:"introduction",level:2},{value:"1. rclpy API Overview",id:"1-rclpy-api-overview",level:2},{value:"Core Components",id:"core-components",level:3},{value:"Node Lifecycle",id:"node-lifecycle",level:3},{value:"2. Creating Custom Nodes",id:"2-creating-custom-nodes",level:2},{value:"Basic Node Structure",id:"basic-node-structure",level:3},{value:"Node Naming Best Practices",id:"node-naming-best-practices",level:3},{value:"Multiple Publishers/Subscribers",id:"multiple-publisherssubscribers",level:3},{value:"3. Timers and Periodic Execution",id:"3-timers-and-periodic-execution",level:2},{value:"Creating Timers",id:"creating-timers",level:3},{value:"Dynamic Timer Control",id:"dynamic-timer-control",level:3},{value:"4. Parameters",id:"4-parameters",level:2},{value:"Declaring and Using Parameters",id:"declaring-and-using-parameters",level:3},{value:"Setting Parameters at Launch",id:"setting-parameters-at-launch",level:3},{value:"Dynamic Parameter Updates",id:"dynamic-parameter-updates",level:3},{value:"5. Message Handling Patterns",id:"5-message-handling-patterns",level:2},{value:"Pattern 1: Synchronous Processing",id:"pattern-1-synchronous-processing",level:3},{value:"Pattern 2: Asynchronous with Queue",id:"pattern-2-asynchronous-with-queue",level:3},{value:"Pattern 3: Latest Message Only",id:"pattern-3-latest-message-only",level:3},{value:"Pattern 4: Message Synchronization",id:"pattern-4-message-synchronization",level:3},{value:"6. Error Handling and Logging",id:"6-error-handling-and-logging",level:2},{value:"Logging Levels",id:"logging-levels",level:3},{value:"Exception Handling",id:"exception-handling",level:3},{value:"Validation",id:"validation",level:3},{value:"7. Multi-Threading",id:"7-multi-threading",level:2},{value:"MultiThreadedExecutor",id:"multithreadedexecutor",level:3},{value:"8. Testing",id:"8-testing",level:2},{value:"Unit Testing with unittest",id:"unit-testing-with-unittest",level:3},{value:"Summary",id:"summary",level:2},{value:"Review Questions",id:"review-questions",level:2},{value:"Hands-on Exercises",id:"hands-on-exercises",level:2},{value:"Exercise 1: Configurable Timer Node",id:"exercise-1-configurable-timer-node",level:3},{value:"Exercise 2: Sensor Validator",id:"exercise-2-sensor-validator",level:3},{value:"Exercise 3: Multi-Publisher Node",id:"exercise-3-multi-publisher-node",level:3},{value:"Further Reading",id:"further-reading",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"python-programming-with-rclpy",children:"Python Programming with rclpy"})}),"\n",(0,l.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,l.jsx)(n.p,{children:"By the end of this chapter, you will be able to:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Understand the rclpy API structure and core concepts"}),"\n",(0,l.jsx)(n.li,{children:"Create custom ROS 2 nodes using object-oriented Python"}),"\n",(0,l.jsx)(n.li,{children:"Implement timers, callbacks, and lifecycle management"}),"\n",(0,l.jsx)(n.li,{children:"Handle parameters for runtime configuration"}),"\n",(0,l.jsx)(n.li,{children:"Apply message handling patterns for robust communication"}),"\n",(0,l.jsx)(n.li,{children:"Debug and test Python ROS 2 nodes effectively"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,l.jsxs)(n.p,{children:["While we've used ",(0,l.jsx)(n.code,{children:"rclpy"})," in previous chapters, this chapter dives deeper into Python programming patterns for ROS 2. ",(0,l.jsx)(n.strong,{children:"rclpy"})," is the official Python client library for ROS 2, providing a Pythonic interface to ROS 2's core functionality."]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Why Python for robotics?"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u2705 Rapid prototyping and iteration"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Rich ecosystem (NumPy, OpenCV, TensorFlow)"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Easy integration with AI/ML libraries"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Readable code for algorithm development"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Excellent for high-level logic and coordination"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"When to use Python vs C++:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Python"}),": High-level planning, vision processing, machine learning, prototyping"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"C++"}),": Real-time control, driver implementations, performance-critical code"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"This chapter teaches professional Python patterns for building maintainable, robust ROS 2 applications."}),"\n",(0,l.jsx)(n.h2,{id:"1-rclpy-api-overview",children:"1. rclpy API Overview"}),"\n",(0,l.jsx)(n.h3,{id:"core-components",children:"Core Components"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom rclpy.qos import QoSProfile\nfrom rclpy.parameter import Parameter\nfrom rclpy.executors import MultiThreadedExecutor\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Key classes:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Node"}),": Base class for all ROS 2 nodes"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Publisher"}),": Publishes messages to topics"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Subscription"}),": Receives messages from topics"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Client"}),": Calls services"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Service"}),": Provides service functionality"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"ActionClient/ActionServer"}),": For long-running tasks"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Timer"}),": Executes callbacks periodically"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Parameter"}),": Runtime configuration"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"node-lifecycle",children:"Node Lifecycle"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"# 1. Initialize ROS 2\nrclpy.init(args=args)\n\n# 2. Create node\nnode = MyNode()\n\n# 3. Spin (process callbacks)\nrclpy.spin(node)\n\n# 4. Cleanup\nnode.destroy_node()\nrclpy.shutdown()\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Best practice"}),": Always use try/finally for cleanup:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"def main():\n    rclpy.init()\n    node = MyNode()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n"})}),"\n",(0,l.jsx)(n.h2,{id:"2-creating-custom-nodes",children:"2. Creating Custom Nodes"}),"\n",(0,l.jsx)(n.h3,{id:"basic-node-structure",children:"Basic Node Structure"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"from rclpy.node import Node\n\nclass MyRobotNode(Node):\n    def __init__(self):\n        # ALWAYS call super().__init__ first\n        super().__init__('my_robot_node')\n\n        # Declare parameters\n        self.declare_parameter('update_rate', 10.0)\n\n        # Create publishers/subscribers\n        self.pub = self.create_publisher(String, 'status', 10)\n        self.sub = self.create_subscription(\n            Twist, 'cmd_vel', self.cmd_callback, 10\n        )\n\n        # Create timer\n        rate = self.get_parameter('update_rate').value\n        self.timer = self.create_timer(1.0/rate, self.timer_callback)\n\n        # Initialize state\n        self.counter = 0\n\n        self.get_logger().info('Node initialized')\n\n    def cmd_callback(self, msg):\n        \"\"\"Handle incoming velocity commands\"\"\"\n        self.get_logger().info(f'Received: {msg.linear.x}')\n\n    def timer_callback(self):\n        \"\"\"Periodic update loop\"\"\"\n        self.counter += 1\n        msg = String()\n        msg.data = f'Update {self.counter}'\n        self.pub.publish(msg)\n"})}),"\n",(0,l.jsx)(n.h3,{id:"node-naming-best-practices",children:"Node Naming Best Practices"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"# Good: Descriptive, lowercase with underscores\nsuper().__init__('camera_processor')\nsuper().__init__('robot_state_publisher')\nsuper().__init__('obstacle_detector')\n\n# Bad: Too generic or unclear\nsuper().__init__('node1')\nsuper().__init__('MyNode')\nsuper().__init__('test')\n"})}),"\n",(0,l.jsx)(n.h3,{id:"multiple-publisherssubscribers",children:"Multiple Publishers/Subscribers"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"class SensorFusionNode(Node):\n    def __init__(self):\n        super().__init__('sensor_fusion')\n\n        # Multiple subscribers\n        self.lidar_sub = self.create_subscription(\n            LaserScan, 'scan', self.lidar_callback, 10\n        )\n        self.imu_sub = self.create_subscription(\n            Imu, 'imu', self.imu_callback, 10\n        )\n        self.odom_sub = self.create_subscription(\n            Odometry, 'odom', self.odom_callback, 10\n        )\n\n        # Multiple publishers\n        self.pose_pub = self.create_publisher(\n            PoseStamped, 'fused_pose', 10\n        )\n        self.status_pub = self.create_publisher(\n            String, 'fusion_status', 10\n        )\n\n        # Store latest data\n        self.latest_scan = None\n        self.latest_imu = None\n        self.latest_odom = None\n\n    def lidar_callback(self, msg):\n        self.latest_scan = msg\n        self.fuse_sensors()\n\n    def imu_callback(self, msg):\n        self.latest_imu = msg\n\n    def odom_callback(self, msg):\n        self.latest_odom = msg\n\n    def fuse_sensors(self):\n        \"\"\"Combine sensor data\"\"\"\n        if all([self.latest_scan, self.latest_imu, self.latest_odom]):\n            # Perform fusion\n            fused_pose = self.compute_fused_pose()\n            self.pose_pub.publish(fused_pose)\n"})}),"\n",(0,l.jsx)(n.h2,{id:"3-timers-and-periodic-execution",children:"3. Timers and Periodic Execution"}),"\n",(0,l.jsx)(n.h3,{id:"creating-timers",children:"Creating Timers"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'class PeriodicNode(Node):\n    def __init__(self):\n        super().__init__(\'periodic_node\')\n\n        # Timer that fires every 0.1 seconds (10 Hz)\n        self.timer = self.create_timer(0.1, self.timer_callback)\n\n        # You can have multiple timers\n        self.slow_timer = self.create_timer(1.0, self.slow_callback)\n        self.fast_timer = self.create_timer(0.01, self.fast_callback)\n\n    def timer_callback(self):\n        """Runs at 10 Hz"""\n        pass\n\n    def slow_callback(self):\n        """Runs at 1 Hz"""\n        pass\n\n    def fast_callback(self):\n        """Runs at 100 Hz"""\n        pass\n'})}),"\n",(0,l.jsx)(n.h3,{id:"dynamic-timer-control",children:"Dynamic Timer Control"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'class AdaptiveNode(Node):\n    def __init__(self):\n        super().__init__(\'adaptive_node\')\n        self.timer = self.create_timer(1.0, self.callback)\n\n    def speed_up(self):\n        """Increase update rate"""\n        self.timer.cancel()\n        self.timer = self.create_timer(0.1, self.callback)  # 10x faster\n\n    def slow_down(self):\n        """Decrease update rate"""\n        self.timer.cancel()\n        self.timer = self.create_timer(2.0, self.callback)  # 2x slower\n\n    def pause(self):\n        """Stop timer"""\n        self.timer.cancel()\n\n    def callback(self):\n        pass\n'})}),"\n",(0,l.jsx)(n.h2,{id:"4-parameters",children:"4. Parameters"}),"\n",(0,l.jsx)(n.h3,{id:"declaring-and-using-parameters",children:"Declaring and Using Parameters"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"class ConfigurableNode(Node):\n    def __init__(self):\n        super().__init__('configurable_node')\n\n        # Declare parameters with defaults\n        self.declare_parameter('robot_name', 'robot_1')\n        self.declare_parameter('max_speed', 1.0)\n        self.declare_parameter('enable_safety', True)\n        self.declare_parameter('control_gains', [1.0, 0.1, 0.05])\n\n        # Get parameter values\n        self.robot_name = self.get_parameter('robot_name').value\n        self.max_speed = self.get_parameter('max_speed').value\n        self.safety_enabled = self.get_parameter('enable_safety').value\n        self.gains = self.get_parameter('control_gains').value\n\n        self.get_logger().info(f'Robot: {self.robot_name}')\n        self.get_logger().info(f'Max speed: {self.max_speed} m/s')\n"})}),"\n",(0,l.jsx)(n.h3,{id:"setting-parameters-at-launch",children:"Setting Parameters at Launch"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Command line\nros2 run my_package my_node --ros-args \\\n  -p robot_name:=robot_2 \\\n  -p max_speed:=2.5 \\\n  -p enable_safety:=false\n"})}),"\n",(0,l.jsx)(n.h3,{id:"dynamic-parameter-updates",children:"Dynamic Parameter Updates"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"class DynamicNode(Node):\n    def __init__(self):\n        super().__init__('dynamic_node')\n\n        self.declare_parameter('threshold', 0.5)\n\n        # Register callback for parameter changes\n        self.add_on_set_parameters_callback(self.parameter_callback)\n\n    def parameter_callback(self, params):\n        \"\"\"Called when parameters change\"\"\"\n        for param in params:\n            if param.name == 'threshold':\n                if param.value > 0.0 and param.value < 1.0:\n                    self.get_logger().info(f'Threshold updated: {param.value}')\n                    return SetParametersResult(successful=True)\n                else:\n                    self.get_logger().error('Threshold must be 0-1')\n                    return SetParametersResult(successful=False)\n\n        return SetParametersResult(successful=True)\n"})}),"\n",(0,l.jsx)(n.h2,{id:"5-message-handling-patterns",children:"5. Message Handling Patterns"}),"\n",(0,l.jsx)(n.h3,{id:"pattern-1-synchronous-processing",children:"Pattern 1: Synchronous Processing"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'def callback(self, msg):\n    """Process message immediately"""\n    result = self.process_data(msg)\n    self.publisher.publish(result)\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Use when:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Processing is fast (<10ms)"}),"\n",(0,l.jsx)(n.li,{children:"No blocking operations"}),"\n",(0,l.jsx)(n.li,{children:"Order matters"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"pattern-2-asynchronous-with-queue",children:"Pattern 2: Asynchronous with Queue"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from queue import Queue\nfrom threading import Thread\n\nclass AsyncNode(Node):\n    def __init__(self):\n        super().__init__(\'async_node\')\n\n        self.queue = Queue(maxsize=100)\n\n        # Subscriber puts messages in queue\n        self.sub = self.create_subscription(\n            Image, \'camera\', self.image_callback, 10\n        )\n\n        # Worker thread processes queue\n        self.worker = Thread(target=self.process_queue, daemon=True)\n        self.worker.start()\n\n    def image_callback(self, msg):\n        """Non-blocking: just queue the message"""\n        if not self.queue.full():\n            self.queue.put(msg)\n        else:\n            self.get_logger().warn(\'Queue full, dropping message\')\n\n    def process_queue(self):\n        """Worker thread processes messages"""\n        while rclpy.ok():\n            msg = self.queue.get()\n            # Time-consuming processing\n            result = self.heavy_computation(msg)\n            self.publish_result(result)\n'})}),"\n",(0,l.jsx)(n.h3,{id:"pattern-3-latest-message-only",children:"Pattern 3: Latest Message Only"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'class LatestMessageNode(Node):\n    def __init__(self):\n        super().__init__(\'latest_message_node\')\n\n        self.latest_msg = None\n\n        self.sub = self.create_subscription(\n            LaserScan, \'scan\', self.scan_callback, 10\n        )\n\n        # Process latest message periodically\n        self.timer = self.create_timer(0.1, self.process_latest)\n\n    def scan_callback(self, msg):\n        """Just store the latest message"""\n        self.latest_msg = msg\n\n    def process_latest(self):\n        """Process most recent scan"""\n        if self.latest_msg is not None:\n            self.process_scan(self.latest_msg)\n'})}),"\n",(0,l.jsx)(n.h3,{id:"pattern-4-message-synchronization",children:"Pattern 4: Message Synchronization"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"from message_filters import Subscriber, ApproximateTimeSynchronizer\n\nclass SyncNode(Node):\n    def __init__(self):\n        super().__init__('sync_node')\n\n        # Create synchronized subscribers\n        self.image_sub = Subscriber(self, Image, 'camera/image')\n        self.depth_sub = Subscriber(self, Image, 'camera/depth')\n\n        # Synchronize messages within 0.1 seconds\n        self.sync = ApproximateTimeSynchronizer(\n            [self.image_sub, self.depth_sub],\n            queue_size=10,\n            slop=0.1\n        )\n        self.sync.registerCallback(self.sync_callback)\n\n    def sync_callback(self, image_msg, depth_msg):\n        \"\"\"Called when messages are synchronized\"\"\"\n        # Process synchronized RGB and depth\n        pass\n"})}),"\n",(0,l.jsx)(n.h2,{id:"6-error-handling-and-logging",children:"6. Error Handling and Logging"}),"\n",(0,l.jsx)(n.h3,{id:"logging-levels",children:"Logging Levels"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"class LoggingNode(Node):\n    def __init__(self):\n        super().__init__('logging_node')\n\n        # Different severity levels\n        self.get_logger().debug('Detailed debugging info')\n        self.get_logger().info('Normal operation info')\n        self.get_logger().warn('Warning: potential issue')\n        self.get_logger().error('Error occurred')\n        self.get_logger().fatal('Critical failure')\n"})}),"\n",(0,l.jsx)(n.h3,{id:"exception-handling",children:"Exception Handling"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'def safe_callback(self, msg):\n    """Callback with error handling"""\n    try:\n        result = self.process_message(msg)\n        self.publisher.publish(result)\n\n    except ValueError as e:\n        self.get_logger().error(f\'Invalid data: {e}\')\n\n    except Exception as e:\n        self.get_logger().fatal(f\'Unexpected error: {e}\')\n        # Optionally: self.destroy_node()\n'})}),"\n",(0,l.jsx)(n.h3,{id:"validation",children:"Validation"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'def validate_message(self, msg):\n    """Validate incoming data"""\n    if msg.linear.x > self.max_speed:\n        self.get_logger().warn(\n            f\'Speed {msg.linear.x} exceeds max {self.max_speed}\'\n        )\n        msg.linear.x = self.max_speed\n\n    if math.isnan(msg.linear.x):\n        self.get_logger().error(\'NaN detected in velocity\')\n        return False\n\n    return True\n'})}),"\n",(0,l.jsx)(n.h2,{id:"7-multi-threading",children:"7. Multi-Threading"}),"\n",(0,l.jsx)(n.h3,{id:"multithreadedexecutor",children:"MultiThreadedExecutor"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"from rclpy.executors import MultiThreadedExecutor\n\ndef main():\n    rclpy.init()\n\n    node1 = Node1()\n    node2 = Node2()\n\n    # Multi-threaded executor\n    executor = MultiThreadedExecutor(num_threads=4)\n    executor.add_node(node1)\n    executor.add_node(node2)\n\n    try:\n        executor.spin()\n    finally:\n        executor.shutdown()\n        node1.destroy_node()\n        node2.destroy_node()\n        rclpy.shutdown()\n"})}),"\n",(0,l.jsx)(n.h2,{id:"8-testing",children:"8. Testing"}),"\n",(0,l.jsx)(n.h3,{id:"unit-testing-with-unittest",children:"Unit Testing with unittest"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'import unittest\nimport rclpy\nfrom my_package.my_node import MyNode\n\nclass TestMyNode(unittest.TestCase):\n    @classmethod\n    def setUpClass(cls):\n        rclpy.init()\n\n    @classmethod\n    def tearDownClass(cls):\n        rclpy.shutdown()\n\n    def test_node_creation(self):\n        """Test node initializes correctly"""\n        node = MyNode()\n        self.assertIsNotNone(node)\n        node.destroy_node()\n\n    def test_parameter_default(self):\n        """Test default parameter value"""\n        node = MyNode()\n        param = node.get_parameter(\'max_speed\').value\n        self.assertEqual(param, 1.0)\n        node.destroy_node()\n'})}),"\n",(0,l.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,l.jsx)(n.p,{children:"Key takeaways:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"rclpy"})," provides Pythonic interface to ROS 2"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Object-oriented design"})," with Node base class"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Timers"})," enable periodic execution"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Parameters"})," allow runtime configuration"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Multiple patterns"})," for message handling (sync, async, latest-only)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Proper error handling"})," and logging are essential"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Multi-threading"})," improves performance for concurrent tasks"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Best practices:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Always use try/finally for cleanup"}),"\n",(0,l.jsx)(n.li,{children:"Validate inputs in callbacks"}),"\n",(0,l.jsx)(n.li,{children:"Log appropriately (not too verbose, not too quiet)"}),"\n",(0,l.jsx)(n.li,{children:"Test your nodes with unit tests"}),"\n",(0,l.jsx)(n.li,{children:"Use parameters for configurable values"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"review-questions",children:"Review Questions"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"What is the difference between a timer callback and a subscription callback?"}),"\n",(0,l.jsx)(n.li,{children:"When should you use an asynchronous message processing pattern?"}),"\n",(0,l.jsx)(n.li,{children:"How do you change a parameter value after a node has started?"}),"\n",(0,l.jsxs)(n.li,{children:["Why should you always call ",(0,l.jsx)(n.code,{children:"super().__init__()"})," first in ",(0,l.jsx)(n.code,{children:"__init__()"}),"?"]}),"\n",(0,l.jsxs)(n.li,{children:["What happens if you don't call ",(0,l.jsx)(n.code,{children:"destroy_node()"})," and ",(0,l.jsx)(n.code,{children:"shutdown()"}),"?"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"hands-on-exercises",children:"Hands-on Exercises"}),"\n",(0,l.jsx)(n.h3,{id:"exercise-1-configurable-timer-node",children:"Exercise 1: Configurable Timer Node"}),"\n",(0,l.jsx)(n.p,{children:"Create a node with:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Parameter for update rate (Hz)"}),"\n",(0,l.jsx)(n.li,{children:"Timer that publishes a counter"}),"\n",(0,l.jsx)(n.li,{children:"Ability to change rate without restarting"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"exercise-2-sensor-validator",children:"Exercise 2: Sensor Validator"}),"\n",(0,l.jsx)(n.p,{children:"Create a node that:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Subscribes to sensor data"}),"\n",(0,l.jsx)(n.li,{children:"Validates ranges (min/max)"}),"\n",(0,l.jsx)(n.li,{children:"Publishes only valid data"}),"\n",(0,l.jsx)(n.li,{children:"Logs warnings for invalid data"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"exercise-3-multi-publisher-node",children:"Exercise 3: Multi-Publisher Node"}),"\n",(0,l.jsx)(n.p,{children:"Create a node with:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"3 different publishers (status, diagnostics, data)"}),"\n",(0,l.jsx)(n.li,{children:"Single timer that updates all"}),"\n",(0,l.jsx)(n.li,{children:"Parameters to enable/disable each publisher"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.ros2.org/latest/api/rclpy/",children:"rclpy API Documentation"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Publisher-And-Subscriber.html",children:"ROS 2 Python Tutorial"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"http://wiki.ros.org/PyStyleGuide",children:"Python Style Guide for ROS"})}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Next Chapter"}),": ",(0,l.jsx)(n.a,{href:"/AI_COURSE_book/docs/module-01-ros2/week-04/ch04-tf2-transforms",children:"TF2 Coordinate Transforms \u2192"})]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Previous Chapter"}),": ",(0,l.jsx)(n.a,{href:"/AI_COURSE_book/docs/module-01-ros2/week-03/ch02-services-actions",children:"\u2190 ROS 2 Services and Actions"})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>t});var r=s(6540);const l={},i=r.createContext(l);function a(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);